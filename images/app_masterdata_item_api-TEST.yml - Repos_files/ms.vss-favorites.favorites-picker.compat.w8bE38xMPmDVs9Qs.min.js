"use strict";define("Favorites/Picker",["require","exports","react","VSSUI/Utilities/Event","VSSUI/PickList","VSSUI/ItemIndicator","VSS/Platform/FPS","Favorites/Common/Resources"],function(t,e,o,i,r,s,a,n){!function(t){e.FavoritePickerProvider={},Object.defineProperty(e,"__esModule",{value:!0});var c=function(){function t(t){var e=this;this._artifactsById={},this._disposed=!1,this._builtInGroups=[],this._favoritesByArtifactId={},this._favoriteGroupItems={},this._favoriteIndicatorItems={},this._extendedFavoritesLoaded=!1,this.getItems=function(){if(!e._artifactsPromise){e._artifactsPromise=e._options.getArtifacts();var t=function(t){e._resolvedArtifacts=e.processResolvedArtifacts(t),e._defaultGroup.isLoading=!1,i.EventGroup.raise(e,r.PICKER_CHANGE_EVENT)};u(e._artifactsPromise)?e._artifactsPromise.then(t):t(e._artifactsPromise)}if(!e._options.favoritesContext)return e._resolvedArtifacts||[];if(e._loadFavoriteExtendedData(),!e._favoritesCollection)return[];var o=e._favoritesCollection.value.filter(function(t){return!t.artifactIsDeleted});if(e._favoritesByArtifactId={},e._favoriteGroupItems={},!o.length)return e._resolvedArtifacts||[];for(var s=0,a=o;s<a.length;s++){var n=a[s];e._favoritesByArtifactId[n.artifactId]=n,e._favoriteGroupItems[n.artifactId]=!0}var c=[];if(e._resolvedArtifacts){for(var f=0,d=o;f<d.length;f++){n=d[f];var p=e._artifactsById[n.artifactId];!p&&e._options.getArtifactFromFavorite&&(p=e._options.getArtifactFromFavorite(n)),p&&c.push(p)}for(var l=0,v=e._resolvedArtifacts;l<v.length;l++){var h=v[l],_=e._options.getArtifactId(h);e._favoritesByArtifactId[_]||c.push(h)}e._options.artifactComparer&&(c=c.sort(e._options.artifactComparer))}else if(e._options.getArtifactFromFavorite){for(var I=0,g=o;I<g.length;I++){n=g[I];var m=e._options.getArtifactFromFavorite(n);m&&c.push(m)}e._options.artifactComparer&&(c=c.sort(e._options.artifactComparer))}return c},this.forgetCachedArtifacts=function(){e._artifactsPromise=void 0,e._artifactsById={},e._resolvedArtifacts=void 0},this.onGroupLoadRequest=function(t,o){if(void 0===o&&(o=0),"favorites"===t||"default"===t)return Promise.resolve([]);var s=e._options.getArtifacts(t),a=function(s){var a=e._resolvedArtifacts&&e._resolvedArtifacts.length;return e._resolvedArtifacts=e.processResolvedArtifacts(s),s.length>o&&e._resolvedArtifacts.length===a&&e.groups.some(function(e){return e.name===t&&Boolean(e.isLoading)})?e.onGroupLoadRequest(t,s.length):(i.EventGroup.raise(e,r.PICKER_CHANGE_EVENT),e._resolvedArtifacts)};return u(s)?s.then(a):Promise.resolve(a(s))},this.getListItem=function(t){var o=e._options,i=o.getArtifactName,r=o.getArtifactId,s=o.getArtifactListGroupId,a=o.getArtifactHref,n=o.getArtifactIcon,c={artifact:t,name:i(t),key:r(t)};return e._getFavoriteItem(r(t))?c.groupKey="favorites":s&&(c.groupKey=s(t)),c.groupKey||(c.groupKey="default"),n&&(c.iconProps=n(t)),a&&(c.href=a(t)),c},this.onSelectedItemChanged=function(t){e.setSelectedItem(t);var o=e._options,i=o.onArtifactClicked,r=o.getArtifactHref;return i?i(t):r?a.onClickFPS(e._options.pageContext,r(t),!0,void 0,{telemetrySource:"FavoritePickerProvider"}):void 0},this.onHasMoreSearchResults=function(t){return t===e._lastSearchResults&&Boolean(e._lastSearchResultsContinuationToken)},this._favoritesErrorDelegate=function(t){e._options.onFavoriteLoadError&&e._options.onFavoriteLoadError(t)},this._onFavoritesLoaded=function(t){if(!e._disposed){if(e._favoritesCollection&&e._favoritesCollection!==e._options.favoritesContext.favorites&&e._favoritesCollection.dispose(),e._favoritesCollection=t,e._favoriteGroup.isLoading=!1,t.subscribe(e._onFavoriteItemChanged),e.selectedItem){var o=e._options.getArtifactId(e.selectedItem);e._updateIndicatorItem(o,!!e._getFavoriteItem(o),!1)}return i.EventGroup.raise(e,r.PICKER_CHANGE_EVENT),t}t.dispose()},this._onFavoriteItemChanged=function(t,o){if(t.addedItems)for(var i=0,r=t.addedItems;i<r.length;i++){var s=r[i];e._favoritesByArtifactId[s.artifactId]=s,e._updateIndicatorItem(s.artifactId,!0,!1)}if(t.removedItems)for(var a=0,n=t.removedItems;a<n.length;a++){s=n[a];delete e._favoritesByArtifactId[s.artifactId],e._updateIndicatorItem(s.artifactId,!1,!1)}},t&&this.initialize(t)}return t.prototype.initialize=function(t){var e=this;this._options=t,this.initializeDefaultGroup(),t.getSearchResults&&(this.onSearch=function(o,i,r,s){var a=s&&s===e._lastSearchResults&&e._lastSearchResultsContinuationToken||void 0,n=t.getSearchResults(o,r,a),c=function(t){return e.getUniqueSearchResults(t,Boolean(a))};return u(n)?n.then(c):c(n)});var o=t.favoritesContext;this._favoritesService=t.favoritesService||t.pageContext.getService("IFavoritesService"),o&&this._favoritesService.canUseFavorites()&&(this.initializeFavoriteGroup(),o.favorites?this._onFavoritesLoaded(o.favorites):this._options.hideFavoriteSelectedItemIndicator||this._loadFavorites(),this._favoriteIndicator={getItemIndicator:function(o){var i=t.getArtifactId(o);if(!i)return null;var r=e._getFavoriteItem(i);return r||e._options.getFavoriteFromArtifact&&e._options.getFavoriteFromArtifact(o)?{title:"",item:e._updateIndicatorItem(i,!!r,!0),onClick:function(t,r){var s=!1,a=e._getFavoriteItem(i);if(a)s=!0;else if(!(a=e._options.getFavoriteFromArtifact(o)))return;s?e._favoritesService.removeFavorite(a):e._favoritesService.addFavorite(a)}}:null}})},t.prototype.dispose=function(){this._favoritesCollection&&(this._options.favoritesContext.favorites===this._favoritesCollection&&this._favoritesCollection.dispose(),this._favoritesCollection=void 0),this._disposed=!0},t.prototype.getTitleTextForItem=function(t){return this._options.getRootItemText?this._options.getRootItemText(t):t&&this._options.getArtifactName(t)},t.prototype.processResolvedArtifacts=function(t){for(var e=this,o=0,i=t;o<i.length;o++){var r=i[o];this._artifactsById[this._options.getArtifactId(r)]=r}var s=Object.keys(this._artifactsById).map(function(t){return e._artifactsById[t]});return this._options.artifactComparer&&(s=s.sort(this._options.artifactComparer)),s},Object.defineProperty(t.prototype,"selectedItem",{get:function(){return this._handledInitialSelection||(this._handledInitialSelection=!0,this._selectedItem=this._options.selectedArtifact),this._selectedItem},enumerable:!0,configurable:!0}),t.prototype.setSelectedItem=function(t){if(this._selectedItem=t,t){var e=this._options.getArtifactId(t);this._updateIndicatorItem(e,!!this._getFavoriteItem(e),!0)}},Object.defineProperty(t.prototype,"selectedItemIndicators",{get:function(){return this._favoriteIndicator&&!this._options.hideFavoriteSelectedItemIndicator?this._options.selectedItemIndicators?this._options.selectedItemIndicators.concat([this._favoriteIndicator]):[this._favoriteIndicator]:this._options.selectedItemIndicators||[]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dropdownIndicators",{get:function(){return this._favoriteIndicator?this._options.dropdownIndicators?this._options.dropdownIndicators.concat([this._favoriteIndicator]):[this._favoriteIndicator]:this._options.dropdownIndicators||[]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"groups",{get:function(){var t,e=this;return this._options.groups&&u(this._options.groups)?(this._resolvedGroups||(this._options.groups.then(function(t){e._resolvedGroups=t,i.EventGroup.raise(e,r.PICKER_CHANGE_EVENT)}),this._resolvedGroups=this._getPlaceholderGroups()),t=this._resolvedGroups):t=this._options.groups,this._builtInGroups.concat(t||[])},enumerable:!0,configurable:!0}),t.prototype._getPlaceholderGroups=function(){var t=[];if(this.pivots)for(var e=0,o=this.pivots;e<o.length;e++){var i=o[e];t.push({key:"placeholder",isLoading:!0,loadingMessage:this._options.loadingText,pivotId:i.id})}else t.push({key:"placeholder",isLoading:!0,loadingMessage:this._options.loadingText});return t},Object.defineProperty(t.prototype,"pivots",{get:function(){return this._options.pivots||[]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"limitSearchToPivot",{get:function(){return this._options.limitSearchToPivot||!1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onFilterItemByText",{get:function(){return this._options.onFilterItemByText},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"actions",{get:function(){var t=this._options,e=t.browseAllText,o=t.onBrowseAllClick,i=t.otherActions,r=i?i.slice():[];return o&&r.push({onClick:o,name:e||n.FavoriteItemPickerBrowseAllText,iconProps:{iconName:"Home"}}),r},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isSearchable",{get:function(){return void 0===this._options.isSearchable||this._options.isSearchable},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"searchTextPlaceholder",{get:function(){return this._options.searchTextPlaceholder},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"searchResultsGroupName",{get:function(){return this._options.searchResultsGroupName},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"searchResultsLoadingText",{get:function(){return this._options.searchResultsLoadingText},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"searchNoResultsText",{get:function(){return this._options.searchNoResultsText},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"noItemsText",{get:function(){if(this._favoritesService&&!this._favoritesCollection)return o.createElement("span",{className:"vss-FavoriteItemPicker--noItemsMessage"},n.FavoriteItemPickerLoadingMessage);var t=void 0;return"function"==typeof this._options.getNoItemsMessage&&(t=this._options.getNoItemsMessage()),t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"itemAriaDescription",{get:function(){return n.FavoriteItemPickerAriaDescription},enumerable:!0,configurable:!0}),t.prototype.getUniqueSearchResults=function(t,e){for(var o=e?this._lastSearchResults:[],i=0,r=t||[];i<r.length;i++){var s=r[i],a=this._options.getArtifactId(s);this._artifactsById[a]||this._favoritesByArtifactId[a]||o.push(s)}return this._lastSearchResults=o,this._lastSearchResultsContinuationToken=t&&this._options.getSearchResultsContinuationToken&&this._options.getSearchResultsContinuationToken(t),o},t.prototype.initializeDefaultGroup=function(){var t={key:"default",name:this._options.defaultGroupHeader,isLoading:!0,loadingMessage:this._options.loadingText,pivotId:this._options.defaultGroupPivotId},e=this._tryGetGroupSynchronously("default");e?this._defaultGroup=e:(this._defaultGroup=t,this._builtInGroups.push(t))},t.prototype.initializeFavoriteGroup=function(){var t={key:"favorites",name:this._options.favoriteGroupHeader,isLoading:!0,loadingMessage:this._options.loadingText,pivotId:this._options.favoriteGroupPivotId},e=this._tryGetGroupSynchronously("favorites");e?this._favoriteGroup=e:(this._favoriteGroup=t,this._builtInGroups.unshift(t))},t.prototype._tryGetGroupSynchronously=function(t){var e=this._options.groups;if(e&&!u(e))return e.filter(function(e){return e.key===t})[0]},t.prototype._getFavoriteItem=function(t){var e=this._favoritesByArtifactId[t];return e||!this._favoritesCollection||this._artifactsPromise?e:this._favoritesCollection.value.filter(function(e){return e.artifactId===t})[0]},t.prototype._updateIndicatorItem=function(t,e,o){var i=this._favoriteIndicatorItems,r=this._getIndicatorState(e,!!this._favoriteGroupItems[t]);return t in i?i[t].setState(r,o):i[t]=new s.Item({initialState:r}),i[t]},t.prototype._getIndicatorState=function(t,e){return{title:"",iconProps:{iconName:t?"FavoriteStarFill":"FavoriteStar",className:"vss-FavoriteItemPicker--starIcon ms-font-l"+(e||t?"":" not-initial-favorite"),title:t?n.FavoriteStarFavoritedTitle:n.FavoriteStarUnfavoritedTitle}}},t.prototype._loadFavoriteExtendedData=function(){this._loadFavorites(!0)},t.prototype._loadFavorites=function(t){if(void 0===t&&(t=!1),this._extendedFavoritesLoaded)return Promise.resolve(void 0);var e=this._options.favoritesContext,o=this._favoritesService.getFavorites(e.artifactType,e.artifactScope.type,e.artifactScope.id,t).then(this._onFavoritesLoaded,this._favoritesErrorDelegate);return this._extendedFavoritesLoaded=t,o},t}();e.FavoritePickerProvider.ArtifactPickerProviderBase=c;var f=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e}(c);function u(t){return"function"==typeof t.then}e.FavoritePickerProvider.ArtifactPickerProvider=f}()},["FavoritePickerProvider"]),document.dispatchEvent(new CustomEvent("scriptLoaded",{cancelable:!1,detail:{id:"ms.vss-favorites.favorites-picker"}}));