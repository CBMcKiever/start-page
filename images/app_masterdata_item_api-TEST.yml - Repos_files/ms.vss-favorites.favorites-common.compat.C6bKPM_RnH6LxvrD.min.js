"use strict";define("Favorites/Common",["require","exports","VSS/Platform/Context","VSS/Platform/RestClientBase","VSS/Core/Observable"],function(e,t,r,i,o){var n,a;t.Resources={},Object.defineProperty(t,"__esModule",{value:!0}),t.Resources.FavoriteItemPickerBrowseAllText="Browse all items",t.Resources.FavoriteItemPickerLoadingMessage="Loading favorites...",t.Resources.FavoriteStarFavoritedTitle="Remove from favorites",t.Resources.FavoriteStarUnfavoritedTitle="Add to favorites",t.Resources.FavoriteItemPickerAriaDescription="Use right arrow to toggle favorite status.",t.Resources.FavoriteServiceCouldNotBeQueried="Favorites could not load favorites from service at {0} \n {1}",t.Constants={},Object.defineProperty(t,"__esModule",{value:!0}),(a=t.Constants.FavoriteStorageScopes||(t.Constants.FavoriteStorageScopes={})).Collection="Collection",a.Project="Project",a.Organization="Organization",(n=t.Constants.OwnerScopeTypes||(t.Constants.OwnerScopeTypes={})).Team="Team",n.User="User",t.ContractsService={},Object.defineProperty(t,"__esModule",{value:!0}),function(e){t[e]={},Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.prototype.getFavoriteProviders=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(r){return t={faultInMissingHost:e},[2,this.beginRequest({apiVersion:"4.1-preview.1",routeTemplate:"_apis/Favorite/FavoriteProviders",queryParams:t})]})})},t.prototype.createFavorite=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,this.beginRequest({apiVersion:"4.1-preview.1",method:"POST",routeTemplate:"_apis/Favorite/Favorites/{favoriteId}",body:e})]})})},t.prototype.createFavoriteOfOwner=function(e,t,r){return __awaiter(this,void 0,void 0,function(){var i;return __generator(this,function(o){return i={ownerScopeType:t,ownerScopeId:r},[2,this.beginRequest({apiVersion:"4.1-preview.1",method:"POST",routeTemplate:"_apis/Favorite/Favorites/{favoriteId}",queryParams:i,body:e})]})})},t.prototype.deleteFavoriteById=function(e,t,r,i){return __awaiter(this,void 0,void 0,function(){var o;return __generator(this,function(n){return o={artifactType:t,artifactScopeType:r,artifactScopeId:i},[2,this.beginRequest({apiVersion:"4.1-preview.1",method:"DELETE",routeTemplate:"_apis/Favorite/Favorites/{favoriteId}",routeValues:{favoriteId:e},queryParams:o})]})})},t.prototype.deleteFavoriteOfOwnerById=function(e,t,r,i,o,n){return __awaiter(this,void 0,void 0,function(){var a;return __generator(this,function(s){return a={ownerScopeType:t,ownerScopeId:r,artifactType:i,artifactScopeType:o,artifactScopeId:n},[2,this.beginRequest({apiVersion:"4.1-preview.1",method:"DELETE",routeTemplate:"_apis/Favorite/Favorites/{favoriteId}",routeValues:{favoriteId:e},queryParams:a})]})})},t.prototype.getFavoriteByArtifact=function(e,t,r,i,o){return __awaiter(this,void 0,void 0,function(){var n;return __generator(this,function(a){return n={artifactType:e,artifactId:t,artifactScopeType:r,artifactScopeId:i,includeExtendedDetails:o},[2,this.beginRequest({apiVersion:"4.1-preview.1",routeTemplate:"_apis/Favorite/Favorites/{favoriteId}",queryParams:n})]})})},t.prototype.getFavoriteById=function(e,t,r,i,o){return __awaiter(this,void 0,void 0,function(){var n;return __generator(this,function(a){return n={artifactScopeType:t,artifactType:r,artifactScopeId:i,includeExtendedDetails:o},[2,this.beginRequest({apiVersion:"4.1-preview.1",routeTemplate:"_apis/Favorite/Favorites/{favoriteId}",routeValues:{favoriteId:e},queryParams:n})]})})},t.prototype.getFavoriteOfOwnerById=function(e,t,r,i,o,n,a){return __awaiter(this,void 0,void 0,function(){var s;return __generator(this,function(v){return s={ownerScopeType:t,ownerScopeId:r,artifactScopeType:i,artifactType:o,artifactScopeId:n,includeExtendedDetails:a},[2,this.beginRequest({apiVersion:"4.1-preview.1",routeTemplate:"_apis/Favorite/Favorites/{favoriteId}",routeValues:{favoriteId:e},queryParams:s})]})})},t.prototype.getFavorites=function(e,t,r,i){return __awaiter(this,void 0,void 0,function(){var o;return __generator(this,function(n){return o={artifactType:e,artifactScopeType:t,artifactScopeId:r,includeExtendedDetails:i},[2,this.beginRequest({apiVersion:"4.1-preview.1",routeTemplate:"_apis/Favorite/Favorites/{favoriteId}",queryParams:o})]})})},t.prototype.getFavoritesOfOwner=function(e,t,r,i,o,n){return __awaiter(this,void 0,void 0,function(){var a;return __generator(this,function(s){return a={ownerScopeType:e,ownerScopeId:t,artifactType:r,artifactScopeType:i,artifactScopeId:o,includeExtendedDetails:n},[2,this.beginRequest({apiVersion:"4.1-preview.1",routeTemplate:"_apis/Favorite/Favorites/{favoriteId}",queryParams:a})]})})},t}(i.RestClientBase);t[e].FavoriteClientName="IFavoriteRestClient",t[e].getFavoriteClient=function(r,i){return r.getRestClient(t[e].FavoriteClientName,i)},r.RestClients.add(t[e].FavoriteClientName,{factory:o})}("RestClientFavorite"),function(e){t.FavoritesService={},Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){function t(t,r,i,o,n){var a=e.call(this,r)||this;a.pageContext=t,a.artifactType=i,a.artifactScopeType=o,a.artifactScopeId=n,a.onFavoriteAdded=function(e){a.isAssociatedFavorite(e)&&a.push(e)},a.onFavoriteRemoved=function(e){a.isAssociatedFavorite(e)&&a.removeAll(function(t){return t.id===e.id})};var s=a.pageContext.getService("IFavoritesService");return s.subscribe(a.onFavoriteAdded,"favoriteAdded"),s.subscribe(a.onFavoriteRemoved,"favoriteRemoved"),a}return __extends(t,e),t.prototype.isAssociatedFavorite=function(e){return!(this.artifactType&&e.artifactType!==this.artifactType||this.artifactScopeId&&(e.artifactScope.type!==this.artifactScopeType||e.artifactScope.id!==this.artifactScopeId))},t.prototype.dispose=function(){var e=this.pageContext.getService("IFavoritesService");e.unsubscribe(this.onFavoriteAdded,"favoriteAdded"),e.unsubscribe(this.onFavoriteRemoved,"favoriteRemoved")},t}(o.ObservableArray),n=function(e){function t(){var t=e.apply(this,arguments)||this;return t.favoriteCollections={},t}return __extends(t,e),t.prototype.canUseFavorites=function(){this.pageContext.getService("IVssSecurityService");return this.pageContext.getService("IVssSecurityService").hasPermission("fa557b48-b5bf-458a-bb2b-1b680426fe8b","/Favorites",3)},t.prototype.canFetchExtendedDetails=function(){return!0},t.prototype.getFavorites=function(e,t,r,o){var n=this;if(!this.canUseFavorites()){var a=new i(this.pageContext,[],e,t,r);return Promise.resolve(a)}var s=e+":"+t+":"+r+":"+o,v=this.favoriteCollections[s];if(v)return v;var c=this.getProvider(e).then(function(a){return n.pageContext.getRestClient("IFavoriteRestClient",{serviceInstanceType:a.serviceIdentifier}).getFavorites(e,t,r,o).then(function(o){return new i(n.pageContext,o,e,t,r)})});return this.favoriteCollections[s]=c,c},t.prototype.getTeamFavorites=function(e,t,r,o,n){var a=this;if(!this.canUseFavorites()){var s=new i(this.pageContext,[],t,r,o);return Promise.resolve(s)}var v=t+":"+r+":"+o+":"+n+":"+e,c=this.favoriteCollections[v];if(c)return c;var u=this.getProvider(t).then(function(s){return a.pageContext.getRestClient("IFavoriteRestClient",{serviceInstanceType:s.serviceIdentifier,rootPath:s.serviceUri}).getFavoritesOfOwner("Team",e,t,r,o,n).then(function(e){return new i(a.pageContext,e,t,r,o)})});return this.favoriteCollections[v]=u,u},t.prototype.getFavoritesForScope=function(e,t,r){var o=this;if(!this.canUseFavorites()){var n=new i(this.pageContext,[],void 0,e,t);return Promise.resolve(n)}var a=e+":"+t+":"+r,s=this.favoriteCollections[a];if(s)return s;var v=this.getProviders().then(function(n){var a={};for(var s in n){var v=n[s];if(!a[v.serviceUri]){var c=o.pageContext.getRestClient("IFavoriteRestClient",{serviceInstanceType:v.serviceIdentifier}).getFavorites(void 0,e,t,r);a[v.serviceUri]=c}}var u=[];return Object.keys(a).map(function(e){return a[e]}).forEach(function(e){u.push(e.then(function(e){return e},function(e){return o.pageContext.getService("IVssTelemetryService").publishEvent("Favorites","FavoritesService",e),[]}))}),Promise.all(u).then(function(r){return new i(o.pageContext,[].concat.apply([],r),void 0,e,t)})});return this.favoriteCollections[a]=v,v},t.prototype.addFavorite=function(e){var t=this;return this.canUseFavorites()?this.getProvider(e.artifactType).then(function(r){return t.pageContext.getRestClient("IFavoriteRestClient",{serviceInstanceType:r.serviceIdentifier}).createFavorite(e).then(function(e){return t._notify(e,"favoriteAdded"),e},function(e){throw t._notify(e,"favoriteError"),e})},function(e){throw t._notify(e,"favoriteError"),e}):(this.logNoEditPermissionError(),Promise.resolve(e))},t.prototype.addTeamFavorite=function(e,t){var r=this;return this.canUseFavorites()?this.getProvider(t.artifactType).then(function(i){return r.pageContext.getRestClient("IFavoriteRestClient",{serviceInstanceType:i.serviceIdentifier}).createFavoriteOfOwner(t,"Team",e).then(function(e){return r._notify(e,"favoriteAdded"),e},function(e){throw r._notify(e,"favoriteError"),e})},function(e){throw r._notify(e,"favoriteError"),e}):(this.logNoEditPermissionError(),Promise.resolve(t))},t.prototype.removeFavorite=function(e){var t=this;return this.canUseFavorites()?this.getProvider(e.artifactType).then(function(r){return t.pageContext.getRestClient("IFavoriteRestClient",{serviceInstanceType:r.serviceIdentifier}).deleteFavoriteById(e.id,e.artifactType,e.artifactScope.type,e.artifactScope.id).then(function(){t._notify(e,"favoriteRemoved")},function(e){throw t._notify(e,"favoriteError"),e})},function(e){throw t._notify(e,"favoriteError"),e}):(this.logNoEditPermissionError(),Promise.resolve())},t.prototype.removeTeamFavorite=function(e,t){var r=this;return this.canUseFavorites()?this.getProvider(t.artifactType).then(function(i){return r.pageContext.getRestClient("IFavoriteRestClient",{serviceInstanceType:i.serviceIdentifier}).deleteFavoriteOfOwnerById(t.id,"Team",e,t.artifactType,t.artifactScope.type,t.artifactScope.id).then(function(){r._notify(t,"favoriteRemoved")},function(e){throw r._notify(e,"favoriteError"),e})},function(e){throw r._notify(e,"favoriteError"),e}):(this.logNoEditPermissionError(),Promise.resolve())},t.prototype.getProvider=function(e){if(!this.canUseFavorites())return this.logNoEditPermissionError(),Promise.resolve(null);var t=this.pageContext.getService("IVssContributionService").getSharedData("_favoriteProviders");if(t){var r=t[e];if(r)return Promise.resolve(r)}return this.getProviders().then(function(t){return t[e]})},t.prototype.getProviders=function(){if(!this.canUseFavorites())return this.logNoEditPermissionError(),Promise.resolve({});if(!this.providersPromise){var e=this.pageContext.getRestClient("IFavoriteRestClient");this.providersPromise=e.getFavoriteProviders().then(function(e){return e.reduce(function(e,t){return e[t.artifactType]=t,e},{})})}return this.providersPromise},t.prototype.logNoEditPermissionError=function(){console.error("Favorites client UI should not expose or allow write operations with Favorites, when the active user does not have neccessary permission.")},t}(r.VssObservableService);r.Services.add("IFavoritesService",{serviceFactory:n})}(),function(e){t.Telemetry={},Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.publishNavigateEvent=function(e,t){this.publishEvent("onclick",{favoriteType:e,source:t})},t.prototype.publishEvent=function(e,t){this.pageContext.getService("IVssTelemetryService").publishEvent("Favorites",e,t)},t}(r.VssService);r.Services.add("IFavoritesTelemetryService",{serviceFactory:i}),t.Telemetry.publishNavigateEvent=function(e,t,r){return e.getService("IFavoritesTelemetryService").publishNavigateEvent(t,r)}}()},["Resources","Constants","Contracts/Service","RestClient/Favorite","FavoritesService","Telemetry"]),document.dispatchEvent(new CustomEvent("scriptLoaded",{cancelable:!1,detail:{id:"ms.vss-favorites.favorites-common"}}));