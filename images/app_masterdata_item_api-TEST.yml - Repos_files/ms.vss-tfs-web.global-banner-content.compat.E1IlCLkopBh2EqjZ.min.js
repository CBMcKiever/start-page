"use strict";define("TFS/GlobalBanner",["require","exports","VSS/Platform/Context","VSS/Platform/Fetch","react","VSS/Platform/Layout","VSS/Platform/Components/Format","VSSUI/Link","VSSUI/Icon","VSSUI/TooltipEx"],function(e,t,n,s,o,a,r,i,l,c){var g,u,p,d,m;g=t.Resources={},Object.defineProperty(t,"__esModule",{value:!0}),t.Resources.Dismiss="Dismiss",t.Resources.LearnMore="Learn more",function(e){u=t[e]={},Object.defineProperty(t,"__esModule",{value:!0}),t[e].GlobalMessageChangedEvent="MESSAGE_CHANGED",t[e].GlobalDialogChangedEvent="DIALOG_CHANGED",t[e].GlobalToastChangedEvent="TOAST_CHANGED";var o=function(n){function o(){var e=n.apply(this,arguments)||this;return e.handleEndRequest=function(t){if(t.response&&t.response.headers){var n=t.response.headers.get("X-VSS-GlobalMessage");if(n)try{var s=JSON.parse(n);e.addBanner(s,!1,!0)}catch(e){console.warn("Failed to deserialize X-VSS-GlobalMessage header: "+e)}}},e.handleLegacyGlobalMessage=function(t){e.addBanner(t.detail,!1,!0)},e}return __extends(o,n),o.prototype._serviceStart=function(e){n.prototype._serviceStart.call(this,e);var t=this.pageContext.getService("IVssContributionService"),o=t.getSharedData("globalMessageData");this.currentMessageBanners=o&&o.banners?o.banners:[];var a=t.getSharedData("globalDialogData");this.currentDialogs=a&&a.dialogs?a.dialogs:[],s.requestListeners.subscribe(this.handleEndRequest,"afterRequest"),document.body.addEventListener("legacyGlobalMessage",this.handleLegacyGlobalMessage)},o.prototype._serviceEnd=function(e){s.requestListeners.unsubscribe(this.handleEndRequest,"afterRequest"),document.body.removeEventListener("legacyGlobalMessage",this.handleLegacyGlobalMessage)},o.prototype.addToast=function(n){this._notify(n,t[e].GlobalToastChangedEvent)},o.prototype.getDialog=function(){return this.currentDialogs[0]},o.prototype.addDialog=function(n,s,o){if(o){var a=this.currentDialogs[0];if(a&&(a.priority||0)>=(n.priority||0))return}s&&this.currentDialogs.shift(),this.currentDialogs.unshift(n),this._notify(n,t[e].GlobalDialogChangedEvent)},o.prototype.closeDialog=function(){var n=this.getDialog();if(n&&n.settingId){var s={};s["GlobalDialog/Dismissed/"+n.settingId]=!0,this.pageContext.getRestClient("ISettingsRestClient").setEntries(s,"me")}this.currentDialogs.shift(),this._notify(this.currentDialogs[0],t[e].GlobalDialogChangedEvent)},o.prototype.getBanner=function(){return this.currentMessageBanners[0]},o.prototype.setGlobalMessageBanner=function(e,t,n){this.addBanner(e,t,n)},o.prototype.addBanner=function(n,s,o){if(o){var a=this.currentMessageBanners[0];if(a&&(a.level||0)>=(n.level||0))return}s&&this.currentMessageBanners.shift(),this.currentMessageBanners.unshift(n),this._notify(n,t[e].GlobalMessageChangedEvent)},o.prototype.getActions=function(){var e=this.pageContext.getService("IVssContributionService").getSharedData("globalMessageData");return e&&e.actions?e.actions:void 0},o.prototype.closeBanner=function(){var n=this.getBanner();if(n&&n.settingId){var s={};s["GlobalMessage/Dismissed/"+n.settingId]=!0,this.pageContext.getRestClient("ISettingsRestClient").setEntries(s,"me")}this.currentMessageBanners.shift(),this._notify(this.currentMessageBanners[0],t[e].GlobalMessageChangedEvent)},o}(n.VssObservableService);n.Services.add("IGlobalMessagesService",{serviceFactory:o});var a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.addBanner=function(e){this.pageContext.getService("IGlobalMessagesService").addBanner(e)},t.prototype.addToast=function(e){var t=this.pageContext.getService("IGlobalMessagesService"),n=Object.assign({},e,{onCallToActionClick:function(){e.onCallToActionClick&&e.onCallToActionClick()}});t.addToast(n)},t.prototype.setGlobalMessageBanner=function(e){this.addBanner(e)},t}(n.VssService);n.Services.add("ms.vss-tfs-web.tfs-global-messages-service",{serviceFactory:a,options:1})}("GlobalMessagesService"),function(e){p=t.ComponentsGlobalDialog={},Object.defineProperty(t,"__esModule",{value:!0});var n=function(e){function t(t,n){var s=e.call(this,t,n)||this;s.onCornerDialogClose=function(){s.globalMessageService.closeDialog()},s.onDialogChanged=function(e){s.setState({dialog:e})},s.globalMessageService=n.pageContext.getService("IGlobalMessagesService");var o=s.globalMessageService.getDialog();return s.state={dialog:o},s}return __extends(t,e),t.prototype.componentDidMount=function(){this.globalMessageService.subscribe(this.onDialogChanged,u.GlobalDialogChangedEvent)},t.prototype.render=function(){var e=this.state.dialog;if(!e)return null;var t=e.buttonProps||[];return e.closeButtonProps&&t.push(Object.assign({},e.closeButtonProps,{onClick:this.onCornerDialogClose})),e.componentType?o.createElement(a.WrappedComponent,Object.assign({wrappedType:e.componentType,dependencies:e.contentDependencies},Object.assign({onDismiss:this.onCornerDialogClose},e.contentProperties))):o.createElement(a.WrappedComponent,{wrappedType:"cornerDialog",dependencies:["ms.vss-features.ui-layer-content"],onDismiss:this.onCornerDialogClose,footerButtonProps:t.length>0?t:void 0,titleProps:{text:e.title}},e.message||e.messageFormat&&e.messageLinks?e.messageFormat&&e.messageLinks?o.createElement(r.FormatComponent,{className:"message",format:e.messageFormat},e.messageLinks.map(function(e,t){return o.createElement(i.Link,{href:e.href,target:"_blank",rel:"noopener noreferrer",key:t},e.name)})):o.createElement("div",{className:"message"},e.message):null)},t.prototype.componentWillUnmount=function(){this.globalMessageService.unsubscribe(this.onDialogChanged,u.GlobalDialogChangedEvent),e.prototype.componentWillUnmount.call(this)},t}(a.VssComponent);n.componentType="globalDialog",t.ComponentsGlobalDialog.GlobalDialogComponent=n,a.VssComponent.register(n.componentType,n)}(),function(e){d=t.ComponentsGlobalMessageBanner={},Object.defineProperty(t,"__esModule",{value:!0});var n=function(e){function t(t,n){var s=e.call(this,t,n)||this;s.onKeyDown=function(e){13!==e.keyCode&&32!==e.keyCode||(s.onMessageBannerClose(),e.preventDefault())},s.onMessageBannerClose=function(){s.globalMessagesService.closeBanner()},s.onMessageBannerChanged=function(e){s.setState({messageBanner:e})},s.globalMessagesService=n.pageContext.getService("IGlobalMessagesService"),s.globalMessagesService.subscribe(s.onMessageBannerChanged,u.GlobalMessageChangedEvent);var o=s.globalMessagesService.getBanner();return s.state={messageBanner:o},s}return __extends(t,e),t.prototype.render=function(){var e=this.state.messageBanner;if(!e)return null;var t=e.level,n="info-message",s="Info";return 3===t?(n="success-message",s="Completed"):2===t?(n="error-message",s="Error"):1===t&&(n="warning-message",s="Warning"),e.customIcon&&(s=e.customIcon),o.createElement("div",{className:"global-message-banner flex-row flex-grow fontSizeM "+n},l.Icon({className:"level-icon",iconName:s}),e.message||e.messageFormat&&e.messageLinks?e.messageFormat&&e.messageLinks?o.createElement(r.FormatComponent,{className:"message",format:e.messageFormat},e.messageLinks.map(function(e,t){return o.createElement(i.Link,{href:e.href,target:"_blank",rel:"noopener noreferrer",key:t},e.name)})):o.createElement("div",{className:"message"},e.message):null,e._links&&e._links.learn?o.createElement(i.Link,{className:"learn-link",href:e._links.learn.href},g.LearnMore):null,e.componentType?o.createElement(a.WrappedComponent,Object.assign({wrappedType:e.componentType,dependencies:e.contentDependencies},Object.assign({onDismiss:this.onMessageBannerClose},e.contentProperties))):null,!1!==e.dismissable?o.createElement(c.Tooltip,{showOnFocus:!0,text:g.Dismiss},o.createElement("span",{"aria-label":g.Dismiss,className:"inline-flex-row dismiss",onClick:this.onMessageBannerClose,onKeyDown:this.onKeyDown,role:"button",tabIndex:0},l.Icon({iconName:"Cancel"}))):null)},t.prototype.componentWillUnmount=function(){this.globalMessagesService.unsubscribe(this.onMessageBannerChanged,u.GlobalMessageChangedEvent),e.prototype.componentWillUnmount.call(this)},t}(a.VssComponent);n.componentType="globalBanner",t.ComponentsGlobalMessageBanner.GlobalBannerComponent=n,a.VssComponent.register(n.componentType,n);var s=function(e){function t(t,n){var s=e.call(this,t,n)||this;if(s.globalMessagesService=n.pageContext.getService("IGlobalMessagesService"),s.layoutManager=n.pageContext.getService("IVssLayoutManager"),s.actions=s.globalMessagesService.getActions(),s.actions&&s.actions.length)for(var r=function(e){i.layoutManager.renderCallout(function(t){return o.createElement(a.WrappedComponent,Object.assign({wrappedType:e.componentType,dependencies:e.contentDependencies},Object.assign({onClose:t},e.contentProperties)))})},i=this,l=0,c=s.actions;l<c.length;l++){r(c[l])}return s}return __extends(t,e),t.prototype.render=function(){return null},t}(a.VssComponent);s.componentType="globalActions",a.VssComponent.register(s.componentType,s)}(),function(e){m=t.ComponentsGlobalToast={},Object.defineProperty(t,"__esModule",{value:!0});var n=function(e){function t(t,n){var s=e.call(this,t,n)||this;return s.toastRef=o.createRef(),s.toastQueue=[],s.toastExpiresTimeoutId=-1,s.keyId=0,s.onNewToast=function(e){e.forceOverrideExisting?s.fadeOutAndRenderNew(e):s.state.toast?s.toastQueue.push(e):s.updateCurrentToast(e)},s.onToastExpires=function(){var e=s.toastQueue.shift();e?s.fadeOutAndRenderNew(e):s.clearToast()},s.globalMessagesService=n.pageContext.getService("IGlobalMessagesService"),s.state={},s}return __extends(t,e),t.prototype.render=function(){var e=this.state.toast;return e?o.createElement(a.WrappedComponent,Object.assign({wrappedType:"toast",dependencies:["ms.vss-features.ui-layer-content"],key:"globalToast"+this.keyId,wrappedRef:this.toastRef},e)):null},t.prototype.componentDidMount=function(){this.globalMessagesService.subscribe(this.onNewToast,u.GlobalToastChangedEvent)},t.prototype.componentWillUnmount=function(){this.fadeOutPromiseCancelable&&this.fadeOutPromiseCancelable.cancel(),clearTimeout(this.toastExpiresTimeoutId),this.globalMessagesService.unsubscribe(this.onNewToast,u.GlobalToastChangedEvent)},t.prototype.fadeOutAndRenderNew=function(e){var t=this;this.toastRef.current?(this.fadeOutPromiseCancelable=this.toastRef.current.fadeOut(),this.fadeOutPromiseCancelable.promise.then(function(){t.updateCurrentToast(e)})):this.updateCurrentToast(e)},t.prototype.updateCurrentToast=function(e){var t=this;this.keyId+=1,clearTimeout(this.toastExpiresTimeoutId),this.setState({toast:e},function(){t.toastExpiresTimeoutId=setTimeout(t.onToastExpires,e.duration)})},t.prototype.clearToast=function(){var e=this;this.toastRef.current&&(this.fadeOutPromiseCancelable&&this.fadeOutPromiseCancelable.cancel(),this.fadeOutPromiseCancelable=this.toastRef.current.fadeOut(),this.fadeOutPromiseCancelable.promise.then(function(){e.setState({toast:void 0})}))},t}(a.VssComponent);n.componentType="globalToast",t.ComponentsGlobalToast.GlobalToastComponent=n,a.VssComponent.register(n.componentType,n)}(),function(e){t.ComponentsGlobalMessages={},Object.defineProperty(t,"__esModule",{value:!0});var n=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.render=function(){return o.createElement(o.Fragment,null,o.createElement(d.GlobalBannerComponent,null),o.createElement(p.GlobalDialogComponent,null),o.createElement(m.GlobalToastComponent,null))},t}(a.VssComponent);n.componentType="globalMessages",a.VssComponent.register(n.componentType,n)}()},["Resources","GlobalMessagesService","Components/GlobalDialog","Components/GlobalMessageBanner","Components/GlobalToast","Components/GlobalMessages"]),document.dispatchEvent(new CustomEvent("scriptLoaded",{cancelable:!1,detail:{id:"ms.vss-tfs-web.global-banner-content"}}));