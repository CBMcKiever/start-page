"use strict";define("VSS/Legacy",["require","exports","react","VSS/Platform/Layout","VSS/Platform/Context"],function(e,t,n,o,a){var i,r;!function(e){i=t.ComponentsLegacyLegacy={},Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){function t(){var t=e.apply(this,arguments)||this;return t.onDependenciesResolved=function(){return t.context.pageContext.getService("ILegacyPlatformService").loadModules(t.props.modules,t.props.dependentContributionIds)},t}return __extends(t,e),t.prototype.render=function(){var e=Object.assign({},this.props,{modules:void 0,dependentContributionIds:void 0,onDependenciesResolved:this.onDependenciesResolved});return this.props.componentType&&(e.wrappedType=this.props.componentType),n.createElement(o.WrappedComponent,e,this.props.children)},t}(o.VssComponent);t.ComponentsLegacyLegacy.LegacyComponent=a,o.Components.add("legacy",a)}(),function(e){r=t.LegacyPlatformService={},Object.defineProperty(t,"__esModule",{value:!0});var n,o="ms.vss-web.legacy-platform-data-provider",i=[o,"ms.vss-web.legacy-vss-ui-content"],s=window,c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype._serviceStart=function(t){e.prototype._serviceStart.call(this,t);var n=this.pageContext.getService("IVssContributionService").getData(o);n&&n.preloadContent&&this._ensureLegacyContentLoaded(function(){})},t.prototype.loadModules=function(e,t){var n=this;return new Promise(function(o,a){var i=function(){e&&e.length?s.requirejs("VSS/VSS").requireModules(e).then(function(){o()}):o()};n._ensureLegacyContentLoaded(function(){t&&t.length?s.requirejs(["VSS/Service","VSS/Contributions/Services"],function(e,n){e.getService(n.ExtensionService).getContributions(t,!0,!0,!0).then(function(){i()})}):i()})})},t.prototype.getLegacyPageContext=function(e){var t=this;return this.loadModules().then(function(){var n=s.__vssPageContext;return e&&!n.webContext.team?t.pageContext.getService("IVssContributionService").getDataAsync("ms.vss-tfs-web.team-context-data-provider").then(function(e){return e&&(n=Object.assign({},n,{webContext:Object.assign({},n.webContext,{team:Object.assign({},e)})})),n}):s.__vssPageContext})},t.prototype.requireModules=function(e){return this.loadModules(e).then(function(){return e.map(function(e){return s.requirejs(e)})})},t.prototype._ensureLegacyContentLoaded=function(e){var t=this;if(this._legacyContentLoaded||s.__legacyContentLoaded)e();else if(this._legacyContentLoadedCallbacks)this._legacyContentLoadedCallbacks.push(e);else{this._legacyContentLoadedCallbacks=[e],this.pageContext.getService("IVssPerformanceService").addSplitTiming("LegacyPlatformService.LoadStarted");var n=this.pageContext.getService("IVssContributionService"),a=n.getData(o);a?this._processLegacyData(a):n.getContributionsAsync(i).then(function(){var e=n.getData(o);if(e){var a=n.getData("ms.vss-tfs-web.page-data");a&&(a.project&&(e.pageContext.webContext.project={id:a.project.id,name:a.project.name}),a.team&&(e.pageContext.webContext.team={id:a.team.id,name:a.team.name})),t._processLegacyData(e)}})}},t.prototype._processLegacyData=function(e){var t=this;this.pageContext.getService("IVssContentService").loadScripts(e.content).then(function(){t.pageContext.getService("IVssPerformanceService").addSplitTiming("LegacyPlatformService.ContentLoaded"),t._processLegacyDataWithDOM(e)})},t.prototype._processLegacyDataWithDOM=function(e){var t=this,a=document.createElement("div");a.classList.add("legacy-data"),a.style.display="none",document.body.appendChild(a),this._createLegacyJsonIsland(a,"feature-licenses",e.featureLicenseInfo),this._createLegacyJsonIsland(a,"vss-contribution-data",e.contributionsPageData),this._createLegacyJsonIsland(a,"vss-bundle-data",e.content.filter(function(e){return!!e.bundle})),s._builtinPlugins=e.builtInPlugins,s._builtInBases=e.builtInPluginBases,s.__vssPageContext=e.pageContext,s.__cultureInfo=s.__vssPageContext.microsoftAjaxConfig.cultureInfo,s.requirejs.config(s.__vssPageContext.moduleLoaderConfig),s.requirejs.config({map:{"*":{React:"react"}}});var i=this.pageContext.getService("IVssNavigationService").getCurrentRoute();s.__vssPageContext.navigation.routeId=i.routeId,s.__vssPageContext.navigation.routeTemplates=i.routeTemplates,n=this.pageContext,document.body.addEventListener("fpsLoading",function(){s.__legacyFpsLoading=!0}),document.body.addEventListener("fpsCompleted",function(e){if(e.detail.success){var a=t.pageContext.getService("IVssContributionService").getData(o);if(s.__legacyFpsLoading=!1,s.__updatedLegacyData=a,n=t.pageContext,a){var i=s.__vssPageContext;i.webContext.project=a.pageContext.webContext.project,i.webContext.team=a.pageContext.webContext.team,i.diagnostics.activityId=a.pageContext.diagnostics.activityId,document.body.dispatchEvent(new CustomEvent("legacyFpsComplete",{detail:a}))}}}),window.performance&&window.performance.mark&&window.performance.mark("requireStart"),s.requirejs(e.scriptsToRequire,function(){if(window.performance&&window.performance.mark&&window.performance.mark("requireEnd"),s.requiredModulesLoaded=!0,s.requirejs(["VSS/Events/Page"],function(e){e.getService().fire(e.CommonPageEvents.InitialScriptsLoaded)}),t._legacyContentLoaded=!0,t._legacyContentLoadedCallbacks){for(var e=0,n=t._legacyContentLoadedCallbacks;e<n.length;e++){(0,n[e])()}delete t._legacyContentLoadedCallbacks}})},t.prototype._createLegacyJsonIsland=function(e,t,n){var o=document.createElement("script");o.type="application/json",o.classList.add(t),o.innerText=JSON.stringify(n),e.appendChild(o)},t}(a.VssService);a.Services.add("ILegacyPlatformService",{serviceFactory:c,options:6}),t.LegacyPlatformService.getLWPService=function(e){if(n)return n.getService(e)}}(),t.Legacy={},Object.defineProperty(t,"__esModule",{value:!0}),t.Legacy.LegacyComponent=i.LegacyComponent,t.Legacy.getLWPService=r.getLWPService},["Components/Legacy/Legacy","LegacyPlatformService","Legacy"]),document.dispatchEvent(new CustomEvent("scriptLoaded",{cancelable:!1,detail:{id:"ms.vss-web.legacy-content"}}));