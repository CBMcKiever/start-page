"use strict";define("VSSUI",["require","exports","react","VSS/Core/Util/String"],function(e,t,r,n){var s,i;!function(e){s=t.ComponentsFileInputFileInput={},Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){function s(){var r=e.apply(this,arguments)||this;return r._files=[],r._clear=function(){r._files.forEach(function(e){e.fileReader.readyState!==FileReader.DONE&&e.fileReader.abort()}),r._files=[],r.setState({files:r._files,errorMessage:""}),r._triggerUpdateEvent()},r._remove=function(e){r._files=r._files.filter(function(t){return t!==e}),r.setState({files:r._files}),r._triggerUpdateEvent()},r._addFiles=function(e){if(r.props.allowedFileExtensions&&r.props.allowedFileExtensions.length>0)for(var s=0;s<e.length;s++){for(var i=e[s].name.split(".").pop(),o=!1,a=0;a<r.props.allowedFileExtensions.length;a++)if(i.toLocaleLowerCase()===r.props.allowedFileExtensions[a].toLocaleLowerCase()){o=!0;break}if(!o){var l=n.format(t.VSSResourcesVSSUI.FileInputErrorNotAllowedExtensionType,i,r.props.allowedFileExtensions.join());return void r.setState({errorMessage:l})}}for(var p={},u=(s=0,r._files.length);s<u;s++)p[r.props.fileNamesCaseSensitive?r._files[s].result.name:r._files[s].result.name.toLowerCase()]=1;var c=r._getTotalFilesSize();for(s=0,u=e.length;s<u;s++){if(r.props.maximumSingleFileSize&&e[s].size>r.props.maximumSingleFileSize){l=r._getLimitErrorMessage(n.format(t.VSSResourcesVSSUI.FileInputErrorMaxFileSize,e[s].name,r._getFriendlySizeString(e[s].size),r._getFriendlySizeString(r.props.maximumSingleFileSize)),{fileSize:e[s].size});return void r.setState({errorMessage:l})}c+=e[s].size;var f=r.props.fileNamesCaseSensitive?e[s].name:e[s].name.toLowerCase();if(p[f]){l=n.format(t.VSSResourcesVSSUI.FileInputErrorDuplicateFileName,e[s].name);return void r.setState({errorMessage:l})}p[f]=1}if(r.props.maximumTotalFileSize&&c>r.props.maximumTotalFileSize){l=r._getLimitErrorMessage(n.format(t.VSSResourcesVSSUI.FileInputErrorTotalFileSize,r._getFriendlySizeString(c),r._getFriendlySizeString(r.props.maximumTotalFileSize)),{totalSize:c});r.setState({errorMessage:l})}else{var m=r._files.length+e.length;if(r.props.maximumNumberOfFiles&&m>r.props.maximumNumberOfFiles){var d=1===r.props.maximumNumberOfFiles?t.VSSResourcesVSSUI.FileInputErrorSingleFileOnly:n.format(t.VSSResourcesVSSUI.FileInputErrorMaxNumFiles,r.props.maximumNumberOfFiles);l=r._getLimitErrorMessage(d,{fileCount:m});r.setState({errorMessage:l})}else for(s=0,u=e.length;s<u;s++)r._addFile(e[s])}},r}return __extends(s,e),s.prototype.render=function(){var e=this.props.maximumNumberOfFiles||0,n=this._files,s=this.state&&this.state.errorMessage?this.state.errorMessage:"",i=!e||n.length<e,a=null;this.props.allowedFileExtensions&&(a=this.props.allowedFileExtensions.map(function(e){return"."!==e[0]?"."+e:e}).join());var l=1===e?t.VSSResourcesVSSUI.FileInputDragDropSingleFileLabel:t.VSSResourcesVSSUI.FileInputDragDropLabel,p=1!==e;return r.createElement(o,{dragDropLabel:l,multiple:p,canAddMoreFiles:i,accept:a,files:n,errorMessage:s,addFiles:this._addFiles,remove:this._remove,clear:this._clear})},s.prototype._addFile=function(e){var r=this,s={name:e.name,size:e.size,type:e.type,lastModifiedDate:e.lastModified?new Date(e.lastModified):e.lastModifiedDate,statusText:t.VSSResourcesVSSUI.Loading,isError:!1},i=new FileReader,o={result:s,fileReader:i};this._files.push(o);var a=function(){r.setState({files:r._files,errorMessage:r.state&&r.state.errorMessage?r.state.errorMessage:""}),r._triggerUpdateEvent()},l=function(){s.statusText=r._getFriendlySizeString(e.size),a()};i.onload=function(e){if(s.encoding=0,1===r.props.resultContentType)s.content=i.result||"";else{var t=i.result;t&&t.indexOf(",")>-1?(s.content=t.substr(t.indexOf(",")+1),"//"===s.content.substr(0,2)&&s.content.length%4==2&&(s.content=s.content.substr(2))):s.content="",r.props.detectEncoding&&(s.encoding=function(e){if(void 0===window.atob)return 0;for(var t=window.atob(e),r=[],n=0;n<4;n++)r.push(t.charCodeAt(n));if(254===r[0]&&255===r[1])return 6;if(255===r[0]&&254===r[1])return 0===r[2]&&0===r[3]?5:7;if(239===r[0]&&187===r[1]&&191===r[2])return 3;if(0===r[0]&&0===r[1]&&254===r[2]&&255===r[3])return 4;for(var s=!0,i=(n=0,t.length);n<i;n++){var o=t.charCodeAt(n);if((o<=31||127==o)&&9!=o&&12!=o&&13!=o&&10!=o&&26!=o)return 1;o>127&&(s=!1)}return s?2:3}(s.content))}l()},i.onerror=function(e){n.format(t.VSSResourcesVSSUI.FileInputReadErrorFormat,s.name,i.error.message);s.statusText=t.VSSResourcesVSSUI.FileInputErrorLabel,s.isError=!0,a()},i.onloadend=function(e){a()},1===this.props.resultContentType?i.readAsText(e):2===this.props.resultContentType?(s.encoding=0,s.file=e,l(),a()):i.readAsDataURL(e)},s.prototype._triggerUpdateEvent=function(){this.props.updateHandler&&this.props.updateHandler({loading:this._files.some(function(e){return e.fileReader.readyState!==FileReader.DONE}),files:this._files})},s.prototype._getTotalFilesSize=function(){for(var e=0,t=this._files,r=0,n=t.length;r<n;r++)e+=t[r].result.size;return e},s.prototype._getLimitErrorMessage=function(e,t){var r=e;return this.props.limitMessageFormatter&&(r=this.props.limitMessageFormatter(e,t)),r},s.prototype._getFriendlySizeString=function(e,r){void 0===r&&(r=1);Math.pow(10,r);return e<1024?n.format(t.VSSResourcesVSSUI.FileSizeBytesFormat,e):e<1048576?n.format(t.VSSResourcesVSSUI.FileSizeKBFormat,Math.round(e/1024*10)/10):n.format(t.VSSResourcesVSSUI.FileSizeMBFormat,Math.round(e/1048576*10)/10)},s}(r.Component);t.ComponentsFileInputFileInput.FileInput=i;var o=function(e){function n(){var t=e.apply(this,arguments)||this;return t._onClearClick=function(){t.props.clear&&t.props.clear()},t._onRemoveClick=function(e){t.props.remove&&t.props.remove(e)},t._onRemoveKeyDown=function(e,r){"Enter"!==e.key&&" "!==e.key&&"Spacebar"!==e.key||t.props.remove&&t.props.remove(r)},t._onBrowseContainerClick=function(){t._fileInput&&t._fileInput.click()},t._onBrowseContainerKeyPress=function(e){!t._fileInput||13!==e.which&&32!==e.which||t._fileInput.click()},t._resolveFileInput=function(e){t._fileInput=e},t._resolveRemoveLink=function(e){t._removeLink||(t._removeLink=e)},t._onDragEnter=function(e){t._setDropEffect(e),e.preventDefault(),t.setState({isDragging:!0})},t._onDragLeave=function(e){e.preventDefault(),t.setState({isDragging:!1})},t._onDragOver=function(e){t._setDropEffect(e),e.preventDefault(),t.setState({isDragging:!0})},t._onDrop=function(e){t._setDropEffect(e),e.preventDefault(),t.setState({isDragging:!1});var r=e.dataTransfer.files;r&&r.length>0&&t.props.addFiles&&t.props.addFiles(r)},t._onFileInputChange=function(e){t._removeLink=void 0,e.currentTarget.files&&e.currentTarget.files.length&&(t.props.addFiles&&t.props.addFiles(e.currentTarget.files),e.currentTarget.value="")},t}return __extends(n,e),n.prototype.render=function(){var e=this,n=t.Util.css("vss-FileInput-filesDropTarget",this.state.isDragging?this.props.dragOverCssClass||"vss-FileInput-dragOver":"");return r.createElement("div",{className:"vss-FileInput"},this.props.canAddMoreFiles&&r.createElement("div",{className:n,onDragOver:this._onDragOver,onDragLeave:this._onDragLeave,onDragEnter:this._onDragEnter,onDrop:this._onDrop},r.createElement("div",{className:"vss-FileInput-dragDropTable",role:"presentation"},r.createElement("div",{className:"vss-FileInput-dragDropLabel"},r.createElement("span",null,this.props.dragDropLabel)),r.createElement("div",{className:"vss-FileInput-browseButton"},r.createElement("button",{className:"vss-FileInput-browseContainer",onKeyPress:this._onBrowseContainerKeyPress,onClick:this._onBrowseContainerClick},t.VSSResourcesVSSUI.FileInputBrowseButtonLabel),r.createElement("input",{type:"file",ref:this._resolveFileInput,onChange:this._onFileInputChange,accept:this.props.accept,multiple:this.props.multiple,style:{display:"none"}})))),this.props.files.length>1&&r.createElement("div",{className:"vss-FileInput-overallStatusContainer"},r.createElement("span",{className:"vss-FileInput-overallStatusActions"},r.createElement("a",{onClick:this._onClearClick},t.VSSResourcesVSSUI.FileInputRemoveAll))),r.createElement("div",{className:"vss-FileInput-errorContainer"},this.props.errorMessage),this.props.files.length>0&&r.createElement("ul",{className:"vss-FileInput-fileList",style:{display:"block"}},this.props.files.map(function(n){return r.createElement("li",{key:n.result.name},r.createElement("div",{className:"vss-FileInput-headerContainer"},r.createElement("span",{className:"vss-FileInput-fileName"},n.result.name)),r.createElement("div",{className:"vss-FileInput-detailsContainer"},r.createElement("span",{className:"vss-FileInput-status"},n.result.statusText),r.createElement("span",{className:"vss-FileInput-links"},r.createElement("a",{tabIndex:0,ref:e._resolveRemoveLink,onKeyDown:function(t){return e._onRemoveKeyDown(t,n)},onClick:function(){return e._onRemoveClick(n)},role:"button"},t.VSSResourcesVSSUI.FileInputRemoveFile))))})))},n.prototype.componentWillMount=function(){this.setState({isDragging:!1})},n.prototype.componentDidUpdate=function(){this._removeLink&&this._removeLink.focus()},n.prototype._setDropEffect=function(e){try{e.dataTransfer.dropEffect="copy"}catch(e){}},n}(r.Component)}(),function(e){i=t[e]={},Object.defineProperty(t,"__esModule",{value:!0}),function(r){for(var n in r)t[e].hasOwnProperty(n)||(t[e][n]=r[n])}(s)}("ComponentsFileInputindex"),function(e){t[e]={},Object.defineProperty(t,"__esModule",{value:!0}),function(r){for(var n in r)t[e].hasOwnProperty(n)||(t[e][n]=r[n])}(i)}("FileInput")},["Components/FileInput/FileInput","Components/FileInput/index","FileInput"]),document.dispatchEvent(new CustomEvent("scriptLoaded",{cancelable:!1,detail:{id:"ms.vss-features.ui-fileinput-content"}}));